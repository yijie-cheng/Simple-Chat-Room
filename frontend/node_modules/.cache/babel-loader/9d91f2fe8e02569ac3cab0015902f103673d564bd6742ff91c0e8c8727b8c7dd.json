{"ast":null,"code":"var _jsxFileName = \"/Users/chengyijie/Downloads/github_collection/simple-chat-room/frontend/src/containers/ChatRoom.js\",\n  _s = $RefreshSig$();\nimport { useState, useEffect, useRef } from \"react\";\nimport { Tabs, Input, Tag } from \"antd\";\nimport { useChat } from \"./hooks/useChat\";\nimport styled from \"styled-components\";\nimport Title from \"../components/Title\";\nimport Message from \"../components/Message\";\nimport ChatModal from \"../components/ChatModal\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ChatBoxesWrapper = styled(Tabs)`\n  width: 100%;\n  height: 300px;\n  background: #eeeeee52;\n  border-radius: 10px;\n  margin: 20px;\n  padding: 20px;\n`;\n_c = ChatBoxesWrapper;\nconst ChatBoxWrapper = styled.div`\n  height: 204px;\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n`;\n_c2 = ChatBoxWrapper;\nconst FootRef = styled.div`\n  height: 20px;\n`;\n_c3 = FootRef;\nconst ChatRoom = () => {\n  _s();\n  const {\n    me,\n    messages,\n    msgSent,\n    setMsgSent,\n    sendMessage,\n    displayStatus\n  } = useChat();\n  const [chatBoxes, setChatBoxes] = useState([]);\n  const [activeKey, setActiveKey] = useState(\"\");\n  const [msg, setMsg] = useState(\"\");\n  const [modalOpen, setModalOpen] = useState(false);\n  const msgFooter = useRef(null);\n  const displayChat = chat => chat.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n    style: {\n      color: \"#ccc\"\n    },\n    children: \" No message... \"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 40,\n    columnNumber: 7\n  }, this) : /*#__PURE__*/_jsxDEV(ChatBoxWrapper, {\n    children: [chat.map(({\n      send,\n      body\n    }, i) => /*#__PURE__*/_jsxDEV(Message, {\n      isMe: send === me,\n      message: body\n    }, i, false, {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 11\n    }, this)), /*#__PURE__*/_jsxDEV(FootRef, {\n      ref: msgFooter\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 42,\n    columnNumber: 7\n  }, this);\n  const extractChat = friend => {\n    return displayChat(messages.filter(({\n      send,\n      to\n    }) => to === friend && send === me || to === me && send === friend));\n  };\n  useEffect(() => {\n    setChatBoxes(chatBoxes.map(box => ({\n      ...box,\n      children: extractChat(box.key)\n    })));\n  }, [messages]);\n  const createChatBox = friend => {\n    if (chatBoxes.some(({\n      key\n    }) => key === friend)) {\n      throw new Error(`${friend}'s chat box has already opened.`);\n    }\n    const chat = extractChat(friend);\n    setChatBoxes([...chatBoxes, {\n      label: friend,\n      children: chat,\n      key: friend\n    }]);\n    setActiveKey(friend);\n    return friend;\n  };\n  const removeChatBox = (targetKey, activeKey) => {\n    let newActiveKey = activeKey;\n    const index = chatBoxes.findIndex(({\n      key\n    }) => key === targetKey);\n    const newChatBoxes = chatBoxes.filter(({\n      key\n    }) => key !== targetKey);\n    if (newActiveKey === targetKey) {\n      if (newChatBoxes.length) {\n        newActiveKey = index === 0 ? newChatBoxes[0].key : newChatBoxes[index - 1].key;\n      } else {\n        newActiveKey = \"\";\n      }\n    }\n    setChatBoxes(newChatBoxes);\n    setActiveKey(newActiveKey);\n  };\n  const scrollToBottom = () => {\n    var _msgFooter$current;\n    (_msgFooter$current = msgFooter.current) === null || _msgFooter$current === void 0 ? void 0 : _msgFooter$current.scrollIntoView({\n      behavior: \"smooth\",\n      block: \"start\"\n    });\n  };\n  useEffect(() => {\n    scrollToBottom();\n    setMsgSent(false);\n  }, [msgSent]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Title, {\n      name: me\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatBoxesWrapper, {\n      tabBarStyle: {\n        height: '36pt'\n      },\n      type: \"editable-card\",\n      activeKey: activeKey,\n      onChange: setActiveKey,\n      onEdit: (targetKey, action) => {\n        if (action === 'add') setModalOpen(true);else if (action === 'remove') removeChatBox(targetKey, activeKey);\n      },\n      items: chatBoxes\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatModal, {\n      open: modalOpen,\n      onCreate: ({\n        name\n      }) => {\n        setActiveKey(createChatBox(name));\n        setModalOpen(false);\n      },\n      onCancel: () => setModalOpen(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Input.Search, {\n      value: msg,\n      onChange: e => setMsg(e.target.value),\n      enterButton: \"Send\",\n      placeholder: \"Type a message here...\",\n      onSearch: msg => {\n        if (!msg) {\n          displayStatus({\n            type: \"error\",\n            msg: \"Please enter a message body.\"\n          });\n          return;\n        }\n        sendMessage({\n          send: me,\n          to: activeKey,\n          body: msg\n        });\n        setMsg(\"\");\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(ChatRoom, \"dem35A7auk7I2ULxoLuytF4uv+s=\", false, function () {\n  return [useChat];\n});\n_c4 = ChatRoom;\nexport default ChatRoom;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"ChatBoxesWrapper\");\n$RefreshReg$(_c2, \"ChatBoxWrapper\");\n$RefreshReg$(_c3, \"FootRef\");\n$RefreshReg$(_c4, \"ChatRoom\");","map":{"version":3,"names":["useState","useEffect","useRef","Tabs","Input","Tag","useChat","styled","Title","Message","ChatModal","jsxDEV","_jsxDEV","Fragment","_Fragment","ChatBoxesWrapper","_c","ChatBoxWrapper","div","_c2","FootRef","_c3","ChatRoom","_s","me","messages","msgSent","setMsgSent","sendMessage","displayStatus","chatBoxes","setChatBoxes","activeKey","setActiveKey","msg","setMsg","modalOpen","setModalOpen","msgFooter","displayChat","chat","length","style","color","children","fileName","_jsxFileName","lineNumber","columnNumber","map","send","body","i","isMe","message","ref","extractChat","friend","filter","to","box","key","createChatBox","some","Error","label","removeChatBox","targetKey","newActiveKey","index","findIndex","newChatBoxes","scrollToBottom","_msgFooter$current","current","scrollIntoView","behavior","block","name","tabBarStyle","height","type","onChange","onEdit","action","items","open","onCreate","onCancel","Search","value","e","target","enterButton","placeholder","onSearch","_c4","$RefreshReg$"],"sources":["/Users/chengyijie/Downloads/github_collection/simple-chat-room/frontend/src/containers/ChatRoom.js"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\nimport { Tabs, Input, Tag } from \"antd\";\nimport { useChat } from \"./hooks/useChat\";\nimport styled from \"styled-components\";\nimport Title from \"../components/Title\";\nimport Message from \"../components/Message\";\nimport ChatModal from \"../components/ChatModal\";\n\nconst ChatBoxesWrapper = styled(Tabs)`\n  width: 100%;\n  height: 300px;\n  background: #eeeeee52;\n  border-radius: 10px;\n  margin: 20px;\n  padding: 20px;\n`;\n\nconst ChatBoxWrapper = styled.div`\n  height: 204px;\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n`;\n\nconst FootRef = styled.div`\n  height: 20px;\n`;\n\nconst ChatRoom = () => {\n  const { me, messages, msgSent, setMsgSent, sendMessage, displayStatus } = useChat();\n  const [chatBoxes, setChatBoxes] = useState([]);\n  const [activeKey, setActiveKey] = useState(\"\");\n  const [msg, setMsg] = useState(\"\");\n  const [modalOpen, setModalOpen] = useState(false);\n\n  const msgFooter = useRef(null);\n\n  const displayChat = (chat) => (\n    chat.length === 0 ? (\n      <p style={{ color: \"#ccc\" }}> No message... </p>\n    ) : (\n      <ChatBoxWrapper>\n        {chat.map(({send, body}, i) => (\n          <Message isMe={send === me} message={body} key={i} />\n        ))}\n        <FootRef ref={msgFooter} />\n      </ChatBoxWrapper>\n    )\n  );\n\n  const extractChat = (friend) => {\n    return displayChat(\n      messages.filter(({ send, to }) => (to === friend && send === me) || (to === me && send === friend))\n    );\n  };\n\n  useEffect(() => {\n    setChatBoxes(chatBoxes.map(box => ({\n      ...box,\n      children: extractChat(box.key)\n    })));\n  }, [messages]);\n\n  const createChatBox = (friend) => {\n    if (chatBoxes.some(({ key }) => key === friend)) {\n      throw new Error(`${friend}'s chat box has already opened.`);\n    }\n    const chat = extractChat(friend);\n    setChatBoxes([...chatBoxes, { label: friend, children: chat, key: friend }]);\n    setActiveKey(friend);\n    return friend;\n  };\n\n  const removeChatBox = (targetKey, activeKey) => {\n    let newActiveKey = activeKey;\n    const index = chatBoxes.findIndex(({ key }) => key === targetKey);\n    const newChatBoxes = chatBoxes.filter(({ key }) => key !== targetKey);\n\n    if (newActiveKey === targetKey) {\n      if (newChatBoxes.length) {\n        newActiveKey = index === 0 ? newChatBoxes[0].key : newChatBoxes[index - 1].key;\n      } else {\n        newActiveKey = \"\";\n      }\n    }\n    \n    setChatBoxes(newChatBoxes);\n    setActiveKey(newActiveKey);\n  };\n\n  const scrollToBottom = () => {\n    msgFooter.current?.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n    setMsgSent(false);\n  }, [msgSent]);\n\n  return (\n    <>\n      <Title name={me} />\n      <ChatBoxesWrapper\n        tabBarStyle={{ height: '36pt' }}\n        type=\"editable-card\"\n        activeKey={activeKey}\n        onChange={setActiveKey}\n        onEdit={(targetKey, action) => {\n          if (action === 'add') setModalOpen(true);\n          else if (action === 'remove') removeChatBox(targetKey, activeKey);\n        }}\n        items={chatBoxes}\n      />\n      <ChatModal\n        open={modalOpen}\n        onCreate={({ name }) => {\n          setActiveKey(createChatBox(name));\n          setModalOpen(false);\n        }}\n        onCancel={() => setModalOpen(false)}\n      />\n      <Input.Search\n        value={msg}\n        onChange={e => setMsg(e.target.value)}\n        enterButton=\"Send\"\n        placeholder=\"Type a message here...\"\n        onSearch={msg => {\n          if (!msg) {\n            displayStatus({\n              type: \"error\",\n              msg: \"Please enter a message body.\"\n            });\n            return;\n          }\n          sendMessage({ send: me, to: activeKey, body: msg });\n          setMsg(\"\");\n        }}\n      />\n    </>\n  );\n};\n\nexport default ChatRoom;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}